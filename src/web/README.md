# COBRA Web Interface

Demo web application for analyzing COBOL code and generating AWS modernization artifacts.

## Architecture

- **Frontend**: React + TypeScript + Vite (runs on `localhost:3000`)
- **Backend**: Express.js API (runs on `localhost:3001`)
- **Code Editor**: Monaco Editor with COBOL syntax highlighting
- **Diagram Rendering**: Mermaid.js for architecture visualization

## Getting Started

### Prerequisites

- Node.js 18+ installed
- COBRA core dependencies installed (run `npm install` in project root)

### Installation

1. Install backend dependencies (already done if you ran `npm install` in root):

```bash
npm install
```

2. Install frontend dependencies:

```bash
cd src/web/frontend
npm install
```

### Running the Application

#### Option 1: Run Both Servers Separately

Terminal 1 - Start the backend API:

```bash
npm run api:dev
```

Terminal 2 - Start the frontend:

```bash
npm run web:dev
```

#### Option 2: Use the Root Scripts

From the project root:

```bash
# Terminal 1
npm run api:dev

# Terminal 2
npm run web:dev
```

The application will be available at:

- Frontend: http://localhost:3000
- Backend API: http://localhost:3001

## Features

### 1. Code Editor

- Monaco Editor with COBOL syntax highlighting
- Supports large COBOL files (up to 5MB)
- Line numbers and syntax coloring

### 2. File Upload

- Drag-and-drop support for COBOL files (.cbl, .cob, .cobol)
- Click to browse and select files
- Visual feedback during drag operations

### 3. Example Snippets

- Pre-loaded COBOL examples:
  - Interest Calculation
  - Balance Inquiry
  - Transaction Posting
- One-click loading into editor
- Business logic descriptions

### 4. Analysis Progress

- Real-time progress indicators
- Visual feedback for each analysis stage:
  - Parsing COBOL
  - Analyzing Logic
  - Generating Explanation
  - Creating AWS Code

### 5. Results Display

Three tabs for viewing results:

**Explanation Tab**

- Natural-language description of business logic
- Inputs, outputs, and business rules
- Generated by LLM analysis

**Architecture Tab**

- Mermaid diagram showing COBOL-to-AWS mapping
- Visual representation of modernization approach
- Interactive diagram rendering

**Generated Code Tab**

- Download Lambda function code (TypeScript)
- Download API Gateway configuration (YAML)
- Download AWS CDK stack (TypeScript)
- Download all artifacts as bundle

## API Endpoints

### POST /api/analyze

Start COBOL analysis.

**Request:**

```json
{
  "cobolSource": "IDENTIFICATION DIVISION..."
}
```

**Response:**

```json
{
  "analysisId": "uuid-string"
}
```

### GET /api/analysis/:id

Get analysis status and results.

**Response:**

```json
{
  "id": "uuid",
  "status": "complete",
  "explanation": "...",
  "architecture": "graph TB...",
  "artifacts": {
    "lambda": true,
    "apiGateway": true,
    "cdk": true
  }
}
```

### GET /api/download/:id/:artifact

Download generated artifact.

**Artifacts:**

- `lambda` - Lambda function code
- `apiGateway` - API Gateway configuration
- `cdk` - CDK stack code
- `all` - All artifacts bundled

### GET /health

Health check endpoint.

## Configuration

### Backend Configuration

Edit `src/web/backend/index.ts` to configure:

- Port (default: 3001)
- Rate limiting (default: 10 requests/minute)
- File size limits (default: 5MB)

### Frontend Configuration

Edit `src/web/frontend/vite.config.ts` to configure:

- Port (default: 3000)
- API proxy settings

## Security Features

- **Rate Limiting**: 10 requests per minute per IP
- **Input Validation**: COBOL syntax validation before processing
- **File Size Limits**: Maximum 5MB upload size
- **CORS**: Configured for local development
- **Error Handling**: Graceful error messages and recovery

## Development

### Building for Production

Frontend:

```bash
cd src/web/frontend
npm run build
```

Backend:

```bash
npm run build
```

### Testing

The web interface can be tested by:

1. Loading example COBOL snippets
2. Uploading your own COBOL files
3. Verifying analysis results
4. Downloading generated artifacts

## Troubleshooting

### Port Already in Use

If port 3000 or 3001 is already in use:

```bash
# Kill process on port 3000
lsof -ti:3000 | xargs kill -9

# Kill process on port 3001
lsof -ti:3001 | xargs kill -9
```

### CORS Issues

If you see CORS errors, ensure:

- Backend is running on port 3001
- Frontend proxy is configured in `vite.config.ts`
- Both servers are running

### Analysis Timeout

If analysis takes too long:

- Check backend logs for errors
- Verify LLM API credentials are configured
- Reduce COBOL file size
- Check network connectivity

## Zero-Cost Deployment

This web interface is designed for local development with zero AWS costs:

- All processing happens locally
- No AWS services are provisioned
- Generated code is saved to local files
- LLM API calls are the only external cost (~$0.01-0.10 per analysis)

### Optional Free Deployment

For public demos, deploy to:

- **GitHub Pages**: Free static hosting
- **Vercel**: Free serverless functions
- **Netlify**: Free tier with 100GB bandwidth

See deployment documentation in the main README for details.

## Architecture Diagram

```
┌─────────────┐
│   Browser   │
│ (React App) │
└──────┬──────┘
       │ HTTP
       ▼
┌─────────────┐
│   Vite Dev  │
│   Server    │
│  :3000      │
└──────┬──────┘
       │ Proxy /api/*
       ▼
┌─────────────┐
│  Express    │
│  API Server │
│  :3001      │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ COBRA Core  │
│  - Parser   │
│  - Analyzer │
│  - Generator│
└─────────────┘
```

## License

MIT
